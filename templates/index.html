<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UltraVid - TikTok Downloader</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="/static/css/glass.css" rel="stylesheet">
</head>
<body class="min-h-screen">
    <div class="carousel-layer" id="carouselLayer">
        <div class="carousel-track" id="carouselTrack"></div>
        </div>
    <video id="bgVideo" class="fixed inset-0 w-full h-full object-cover" autoplay loop muted playsinline style="z-index:-4; filter: blur(28px) saturate(115%) brightness(0.6); display:none"></video>
    <div class="bg-layer" id="cssBg"></div>
    <div class="reels-layer" id="cssReels"></div>
    <div class="noise-layer"></div>
    

    <!-- Hero -->
    <main class="min-h-screen flex items-center justify-center px-4 pb-24">
        <div class="container-hero mx-auto glass stroke gloss p-0 md:p-0 text-white overflow-hidden" id="heroGlass">
            <div class="flex items-center space-x-2 px-4 pt-3">
                <span class="w-3 h-3 rounded-full" style="background:#ff5f56"></span>
                <span class="w-3 h-3 rounded-full" style="background:#ffbd2e"></span>
                <span class="w-3 h-3 rounded-full" style="background:#27c93f"></span>
                <!-- <div class="flex-1 flex justify-center items-center text-xs tracking-wider muted text-center">getultravid.com</div> -->
                </div>
            <div class="px-6 py-6 md:px-8 md:py-8" style="--carousel-duration: 180s;">
                <div class="glass-light rounded-lg p-4 md:p-5 w-full max-w-2xl mx-auto">
                    <pre id="termLog" class="text-xs font-mono muted whitespace-pre-wrap" style="min-height: 5rem;"></pre>
                    <form id="downloadForm" class="space-y-2" style="display:none">
                        <div class="w-full flex items-center py-1 font-mono">
                            <span class="text-xs opacity-80 pr-2">user@vid:~$</span>
                            <input type="url" id="url" name="url" required class="bg-transparent border-0 outline-none focus:outline-none focus:ring-0 flex-1 text-sm text-gray-200 placeholder-gray-500" placeholder="tiktok.com/@user/video/..." style="caret-color:#fff">
                </div>
            </form>
        </div>

            </div>

                                </div>
                            </div>
                            
        
    </main>

    <!-- Minimal Footer with Legal Links (sticky) -->
    <footer class="w-full footer-min fixed left-0 right-0 bottom-0" style="z-index:10; background: transparent; border: 0">
        <div class="w-full px-4 py-4">
            <div class="max-w-6xl mx-auto text-center">
                <p>© 2025 UltraVid</p>
                <p class="text-xs mt-1">For educational purposes only</p>
                <p class="text-xs mt-2">
                    <a href="/terms-of-service" class="underline hover:opacity-80">Terms</a>
                    <span class="mx-2">·</span>
                    <a href="/privacy-policy" class="underline hover:opacity-80">Privacy</a>
                </p>
                <p class="text-xs mt-2">
                    <a href="https://buymeacoffee.com/evangruhlkey" target="_blank" rel="noopener" class="underline hover:opacity-80">Buy me a coffee</a>
                </p>
            </div>
        </div>
    </footer>

    <script>
        document.getElementById('downloadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const url = document.getElementById('url').value;
            const log = document.getElementById('termLog');
            try {
                log.textContent = '$ parsing url...\n';
                const response = await fetch('/download', { method: 'POST', body: new FormData(this) });
                if (!response.ok) {
                    const contentType = response.headers.get('Content-Type') || '';
                    let message = 'Download failed';
                    try {
                        if (contentType.includes('application/json')) {
                            const error = await response.json();
                            message = error.error || message;
                        } else {
                            const text = await response.text();
                            if (text && !text.trim().startsWith('<') && text.length < 500) {
                                message = text;
                            }
                        }
                    } catch (_) {}
                    throw new Error(message);
                }
                log.textContent += '$ downloading...\n';
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = 'video.mp4';
                if (contentDisposition) {
                    const matches = /filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(contentDisposition);
                    if (matches != null && matches[1]) {
                        filename = matches[1].replace(/['"]/g, '');
                    }
                }
                const blob = await response.blob();
                log.textContent += '$ saving file...\n';
                const downloadUrl = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = downloadUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(downloadUrl);
                document.body.removeChild(a);
                log.textContent += '$ complete: ' + filename + '\n';
            } catch (error) {
                log.textContent += 'error: ' + (error.message || error.toString()) + '\n';
            }
        });
        // typewriter intro with smooth, time-based animation, then reveal prompt
        (function(){
            const log = document.getElementById('termLog');
            const form = document.getElementById('downloadForm');
            if(!log || !form) return;
            const lines = [
                "user@vid:~$ welcome to UltraVid",
                "user@vid:~$ this tool fetches the highest quality TikTok video",
                "user@vid:~$ no watermark. fast. private.",
                "user@vid:~$ paste a TikTok URL to begin"
            ];

            const sleep = (ms)=> new Promise(r=>setTimeout(r, ms));

            function typeOut(text, cps=60){
                return new Promise(resolve=>{
                    const base = log.textContent;
                    const start = performance.now();
                    const interval = 1000 / cps;
                    function frame(now){
                        const elapsed = now - start;
                        const count = Math.min(text.length, Math.floor(elapsed / interval));
                        log.textContent = base + text.slice(0, count);
                        if(count < text.length){
                            requestAnimationFrame(frame);
                        } else {
                            resolve();
                        }
                    }
                    requestAnimationFrame(frame);
                });
            }

            (async () => {
                for (const l of lines){
                    await typeOut(l + "\n", 60);
                    await sleep(80);
                }
                form.style.display = 'block';
            })();
        })();
        // interactive gloss
        (function(){
            const g = document.getElementById('heroGlass');
            if(!g) return;
            g.addEventListener('mousemove', (e)=>{
                const rect = g.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * 100;
                const y = ((e.clientY - rect.top) / rect.height) * 100;
                g.style.setProperty('--gx', x + '%');
                g.style.setProperty('--gy', y + '%');
            });
        })();

        // Background video loader with graceful fallback
        (async function(){
            const vid = document.getElementById('bgVideo');
            const cssBg = document.getElementById('cssBg');
            const cssReels = document.getElementById('cssReels');
            const car = document.getElementById('carouselLayer');
            const track = document.getElementById('carouselTrack');
            try {
                // If a bg URL is provided (?bg=https://...mp4), use it
                const params = new URLSearchParams(location.search);
                const remote = params.get('bg');
                if (remote && /^https?:\/\//i.test(remote)) {
                    vid.src = remote;
                    vid.style.display = 'block';
                    if (cssBg) cssBg.style.display = 'none';
                    if (cssReels) cssReels.style.display = 'none';
                    return;
                }
                // Carousel param (?carousel=v1.mp4,v2.mp4,...)
                const carousel = params.get('carousel');
                if (carousel && track) {
                    const files = carousel.split(',').map(s => s.trim()).filter(Boolean);
                    if (files.length > 0) {
                        const build = (arr)=>{
                            arr.forEach(src=>{
                                const d = document.createElement('div');
                                d.className = 'carousel-item';
                                const v = document.createElement('video');
                                v.src = src;
                                v.autoplay = true; v.loop = true; v.muted = true; v.playsInline = true;
                                d.appendChild(v); track.appendChild(d);
                            });
                        };
                        // duplicate for seamless scroll
                        build(files); build(files);
                        car.style.display = 'block';
                        if (cssBg) cssBg.style.display = 'none';
                        if (cssReels) cssReels.style.display = 'none';
                        return;
                    }
                }
                // Auto-detect local media: prefer /static/media, then /static/css/media
                const headOk = async (url) => {
                    try { const r = await fetch(url, { method:'HEAD' }); return r.ok; } catch { return false; }
                };
                // Try single bg first
                if (await headOk('/static/media/bg.mp4')) {
                    vid.src = '/static/media/bg.mp4';
                    vid.style.display = 'block';
                    if (cssBg) cssBg.style.display = 'none';
                    if (cssReels) cssReels.style.display = 'none';
                    return;
                }
                // Try carousel using files found in media folders (including your uploaded ones)
                const candidates = [
                    'Since TikTok is shutting down enjoy this viral moment of mine one las.mp4',
                    'Collab of the century kirk-madrigal Dance DanceTok TrendingDance.mp4',
                    'Had to try this dance dothatthing trend viral fyp.mp4',
                    'i love this trend.mp4',
                    'Go follow my new account Moose funny duo dad nealmcdonough moo.mp4'
                ];
                const bases = ['/static/media/', '/static/css/media/'];
                const detected = [];
                for (const base of bases) {
                    for (const f of candidates) {
                        const url = base + encodeURIComponent(f);
                        if (await headOk(url)) detected.push(url);
                    }
                }
                if (detected.length >= 2 && track) {
                    const build = (arr)=>{
                        arr.forEach(src=>{
                            const d = document.createElement('div');
                            d.className = 'carousel-item';
                            const v = document.createElement('video');
                            v.src = src; v.autoplay = true; v.loop = true; v.muted = true; v.playsInline = true;
                            d.appendChild(v); track.appendChild(d);
                        });
                    };
                    build(detected); build(detected);
                    car.style.display = 'block';
                    if (cssBg) cssBg.style.display = 'none';
                    if (cssReels) cssReels.style.display = 'none';
                    return;
                }
                if (detected.length === 1) {
                    vid.src = detected[0];
                    vid.style.display = 'block';
                    if (cssBg) cssBg.style.display = 'none';
                    if (cssReels) cssReels.style.display = 'none';
                    return;
                }
                // If nothing found, keep CSS layers
            } catch (_) {
                // leave CSS layers active
            }
        })();
    </script>
</body>
</html>

